<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joc Vârcolac - Atribuire Roluri</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 600px; margin: auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        input[type="text"], button { padding: 10px; margin: 5px 0; border-radius: 4px; border: 1px solid #ddd; width: calc(100% - 22px); }
        button { background-color: #007bff; color: white; cursor: pointer; border: none; }
        button:hover { background-color: #0056b3; }
        #messages, #players { border: 1px solid #eee; padding: 10px; min-height: 100px; margin-top: 15px; background-color: #f9f9f9; border-radius: 4px; }
        .role-display { font-size: 1.5em; font-weight: bold; color: #d9534f; margin-top: 20px; text-align: center; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Joc Vârcolac - Atribuire Roluri</h1>

        <div id="connection-area">
            <input type="text" id="playerName" placeholder="Numele tău">
            <button onclick="createRoom()">Creează Cameră</button>
            <input type="text" id="roomCodeInput" placeholder="Cod Cameră">
            <button onclick="joinRoom()">Alătură-te Camerei</button>
        </div>

        <div id="room-area" style="display: none;">
            <p>Ești în camera: <strong id="currentRoomCode"></strong></p>
            <p>Jucători în cameră:</p>
            <ul id="players"></ul>
            <button onclick="startGame()">Începe Jocul</button>
            <p class="role-display" id="myRole"></p>
        </div>

        <div id="messages"></div>
    </div>

    <script>
        const socket = io(); // Se va conecta automat la serverul de pe același domeniu/port

        const playerNameInput = document.getElementById('playerName');
        const roomCodeInput = document.getElementById('roomCodeInput');
        const connectionArea = document.getElementById('connection-area');
        const roomArea = document.getElementById('room-area');
        const currentRoomCodeDisplay = document.getElementById('currentRoomCode');
        const playersList = document.getElementById('players');
        const myRoleDisplay = document.getElementById('myRole');
        const messagesDiv = document.getElementById('messages');

        function logMessage(msg, type = '') {
            const item = document.createElement('div');
            item.textContent = msg;
            item.className = type;
            messagesDiv.appendChild(item);
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to bottom
        }

        function createRoom() {
            const playerName = playerNameInput.value.trim();
            if (playerName) {
                socket.emit('createRoom', playerName);
                logMessage('Se creează camera...', 'success');
            } else {
                logMessage('Introdu un nume.', 'error');
            }
        }

        function joinRoom() {
            const roomCode = roomCodeInput.value.trim();
            const playerName = playerNameInput.value.trim();
            if (roomCode && playerName) {
                socket.emit('joinRoom', roomCode, playerName);
                logMessage(`Se alătură camerei ${roomCode}...`, 'success');
            } else {
                logMessage('Introdu un nume și un cod de cameră.', 'error');
            }
        }

        function startGame() {
            socket.emit('startGame');
            logMessage('Se încearcă începerea jocului...', 'success');
        }

        // --- Evenimente de la server ---
        socket.on('roomCreated', (roomCode, players) => {
            currentRoomCodeDisplay.textContent = roomCode;
            updatePlayersList(players);
            connectionArea.style.display = 'none';
            roomArea.style.display = 'block';
            logMessage(`Camera creată: ${roomCode}. Trimite acest cod prietenilor!`, 'success');
        });

        socket.on('playerJoined', (playerName, players) => {
            updatePlayersList(players);
            logMessage(`${playerName} s-a alăturat camerei.`, 'success');
        });

        socket.on('playerLeft', (playerId, players) => {
            updatePlayersList(players);
            logMessage('Un jucător a părăsit camera.', 'error');
        });

        socket.on('gameStarted', () => {
            logMessage('Jocul a început! Rolurile sunt atribuite...', 'success');
        });

        socket.on('yourRole', (role) => {
            myRoleDisplay.textContent = `Rolul tău: ${role}`;
            logMessage(`Rolul tău a fost atribuit: ${role}`, 'success');
        });

        socket.on('error', (message) => {
            logMessage(`Eroare: ${message}`, 'error');
        });

        function updatePlayersList(players) {
            playersList.innerHTML = '';
            players.forEach(player => {
                const li = document.createElement('li');
                li.textContent = player.name;
                playersList.appendChild(li);
            });
        }

        // Handle initial connection status
        socket.on('connect', () => {
            logMessage('Conectat la server.', 'success');
        });

        socket.on('disconnect', () => {
            logMessage('Deconectat de la server.', 'error');
        });
    </script>
</body>
</html>
